---
title: "Module 3 CT Option 2"
author: "Kimberly Statham"
date: "4/1/2020"
output: 
  word_document:
    reference_docx: rmarkdown template.docx
sansfont: Times New Roman
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rpart)
library(rpart.plot)
```

>  Read in the toyota corolla car file and explore it.  Run some stats on the price, age, year, and mileage.  Explore  categorical variables fuel_type and color to see all the possible values

```{r}
corolla.df <- read.csv("ToyotaCorolla.csv", header = TRUE)
dim(corolla.df)  # find the dimension of data frame
head(corolla.df)  # show the first six rows
#View(corolla.df)  # show all the data in a new tab
#summary(corolla.df)

data.frame(mean=sapply(corolla.df[,c(3,4,6,7)], mean, na.rm=TRUE), 
           sd=sapply(corolla.df[,c(3,4,6,7)], sd, na.rm=TRUE), 
           min=sapply(corolla.df[,c(3,4,6,7)], min, na.rm=TRUE), 
           max=sapply(corolla.df[,c(3,4,6,7)], max, na.rm=TRUE), 
           median=sapply(corolla.df[,c(3,4,6,7)], median, na.rm=TRUE), 
           length=sapply(corolla.df[,c(3,4,6,7)], length),
           miss.val=sapply(corolla.df[,c(3,4,6,7)], function(x) 
             sum(length(which(is.na(x))))))
###Look at the class at levels of categorical variables Fuel_Type and Color
class(corolla.df$Fuel_Type) # Fuel_Type is a factor variable
levels(corolla.df$Fuel_Type)  # It can take one of three levels

class(corolla.df$Color)  # Color is a factor variable
levels(corolla.df$Color)  # It can take one of 10 values

```
>  Run a regression tree for output variable Price with predictor variables Age_08_04, KM, Fuel_Type, HP, Automatic, Doors, Quarterly_Tax, Mfr_Guarantee, Guarantee_Period, Airco, Automatic_Airco, CD_Player, Powered_Windows, Sport_Model, and Tow_Bar with 30 being the maximum numbert of tree levels.  Prune the tree and then plot it.
```{r}

# Select the columns of the output and the predictors
selected.var <- c(3, 4, 7, 8, 9, 12, 14, 17, 19, 21, 25, 26, 28, 30, 34, 39)

car.df <- corolla.df[, selected.var]


rt <- rpart(Price ~ ., data = car.df, method = "anova", control=rpart.control(cp=0.001, minbucket=1, maxdepth=30))
rt
pfit<- prune(rt, cp=   rt$cptable[which.min(rt$cptable[,"xerror"]),"CP"])

# visual format
format(pfit, scientific=FALSE)
c(pfit, type = 1, extra = 1, under = TRUE, 
  box.col=ifelse(rt$frame$var == "<leaf>", 'gray', 'white'))  

node.fun <- function(x, labs, digits, varlen)
{
  sprintf("%0.f", x$frame$yval)
}

# plot the tree
prp(pfit, type = 1, extra = 1, under = TRUE, 
    box.col=ifelse(rt$frame$var == "<leaf>", 'gray', 'white'), node.fun=node.fun)

```
  

##### Module 3: Module 3: Critical Thinking-Option #2: Regression Tree
	There were two objectives for this assignment.  The first objective was to learn how to create an R Markdown file.  The second objective was to generate a regression tree using the provided ToyotaCorolla.csv file.   The markdown file contained the R code to generate the regression tree as well as all associated explanatory text.


#### Option #2: Regression Tree
	The result from the regression tree was a little confusing.  The control parameter was set to rpart.control with parameter cp, minbucket, and maxdepth set.  The maxdepth parameter was set to 30 for a maximum number of tree levels.  The minbucket was set to 1 for a minimum number of records in a terminal node.  The cp was set to 0.001.   After running the rpart function, I had a difficult time understanding the results so I ran the prune function as well as the functions to plot the tree because the visual representation of the regression tree was easier to understand.  The plot displays nicely in R Studio.  Unfortunately, the plot in the word document from the R Markdown generation is difficult to view.  
	The most difficult piece of this assignment was getting the text to display the way I wanted in the word document generated by R Markdown.  A new page break was very difficult to create which was surprising.  I created a word template and then modified heading 5 in the template to start a new page before the heading.  This worked but seemed like an irrational way to do this.  I believe there could be an entire class dedicated to just R Markdown.  I was not able to get indentions generated for the beginning of paragraphs.  I tried many things including adding two spaces at the end of the headings as the R Markdown cheat sheet suggests.  At this point, I am not an enthusiast of R Markdown.  I can see some of the benefits to using it but for a beginner it is very cumbersome to generate text in an APA format.   
	In summary, this was a good introduction to R Markdown.  I see the advantage in generating reports with embedded R code and associated visuals but it will take a lot more practice to be able to generate professional looking documents. 

